'</br> Award: ', Award)) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
plot_ly(
data = data$struc_data[[1]],
x = ~year,
y = ~country,
z = ~lifeExp,
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> Year: ', year,
'</br> Agency: ', country,
'</br> Award: ', lifeExp)) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
plot_ly(
data = data$struc_data[[2]],
x = ~year,
y = ~country,
z = ~lifeExp,
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> Year: ', year,
'</br> Agency: ', country,
'</br> Award: ', lifeExp)) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
data$struc_data[[1]]
data$struc_data[[1]][1]
colnames(data$struc_data[[1]])
colnames(data$struc_data[[1]])[1]
enquo(colnames(data$struc_data[[1]])[1])
quo_x <- enquo(colnames(data$struc_data[[1]])[1])
colnames(data$struc_data[[1]])[1]
quo_x <- enquo(colnames(data$struc_data[[1]]))
enquo("year")
enquo(year)
enquo(data)
test <- enquo(data)
test
quo_x <- quo(colnames(data$struc_data[[1]]))
quo_x <- enquo(colnames(data$struc_data[[1]]))
colnames(data$struc_data[[1]]))
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data
}
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
data <- heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
colnames(data$struc_data[[1]]))
colnames(data$struc_data[[1]])
colnames(data$struc_data[[1]])[[1]]
as.formula(x_var)
as.formula(paste(x_var))
x_var <- colnames(data$struc_data[[1]])[[1]])
x_var <- colnames(data$struc_data[[1]])[[1]]
as.formula(paste(x_var))
as.formula(paste0('~', x_var)
)
colnames(data$struc_data[[1]])
colnames(data$struc_data)
data$struc_data[[1]]
colnames(data$struc_data[[1]])
data$struc_data[[1]]
data$struc_data[[1]][,1]
plot_ly(
data = data$struc_data[[1]],
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', data$struc_data[[1]][,2],
'</br> ',x_var,': ', data$struc_data[[1]][,1],
'</br> ',fill_var,': ', data$struc_data[[1]][,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
data$struc_data[[1]][,1]
cols <- colnames(data$struc_data[[1]])
x_var <- cols[1]
y_var <- cols[2]
fill_var <- cols[3]
plot_ly(
data = data$struc_data[[1]],
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', data$struc_data[[1]][,2],
'</br> ',x_var,': ', data$struc_data[[1]][,1],
'</br> ',fill_var,': ', data$struc_data[[1]][,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
cols[1]
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data
}
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
data <- heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
data$struc_data
heatmap_plot_func <- function(dat){
cols <- colnames(dat)
x_var <- cols[2]
y_var <- cols[1]
fill_var <- cols[3]
plot_ly(
data = dat,
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', dat[,2],
'</br> ',x_var,': ', dat[,1],
'</br> ',fill_var,': ', dat[,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
}
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
map_plot(struc_data, heatmap_plot_func)
data %>%
trelliscope()
}
rm(data)
heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
#data <- data %>%
#  map_plot(struc_data, heatmap_plot_func)
#data %>%
#  trelliscope()
}
heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
dat <- heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
data <- heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data
#data <- data %>%
#  map_plot(struc_data, heatmap_plot_func)
#data %>%
#  trelliscope()
}
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
data <- heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
data
heatmap_plot_func <- function(dat){
cols <- colnames(dat)
x_var <- cols[2]
y_var <- cols[1]
fill_var <- cols[3]
plot_ly(
data = dat,
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', dat[,2],
'</br> ',x_var,': ', dat[,1],
'</br> ',fill_var,': ', dat[,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
}
heatmap_plot_func(data$struc_data[[1]])
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
mutate(heat_plot = map_plot(.x = struc_data, .f = heatmap_plot_func))
data %>%
trelliscope()
}
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
heatmap_plot_func <- function(dat){
cols <- colnames(dat)
x_var <- cols[2]
y_var <- cols[1]
fill_var <- cols[3]
plot_ly(
data = dat,
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', dat[,2],
'</br> ',x_var,': ', dat[,1],
'</br> ',fill_var,': ', dat[,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
}
heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
heatmap_trelliscope <- function(data, facet, x, y, fill, title = ""){
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
mutate(heat_plot = map_plot(.x = struc_data, .f = heatmap_plot_func))
data %>%
trelliscope(name = title)
}
heatmap_trelliscope(gapminder::gapminder, 'continent', 'year', 'country', 'lifeExp')
#### Testing this crap out
data = gapminder::gapminder
facet = "continent"
x = "year"
y = "country"
fill = "lifeExp"
title = ""
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
mutate(heat_plot = map_plot(.x = struc_data, .f = heatmap_plot_func))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
heatmap_plot_func <- function(dat){
cols <- colnames(dat)
x_var <- cols[2]
y_var <- cols[1]
fill_var <- cols[3]
plot_ly(
data = dat,
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', dat[,2],
'</br> ',x_var,': ', dat[,1],
'</br> ',fill_var,': ', dat[,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
}
#### Testing this crap out
data = gapminder::gapminder
facet = "continent"
x = "year"
y = "country"
fill = "lifeExp"
title = ""
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <<- c(x,y)
colnames(place_holder_dat) <- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
mutate(heat_plot = map_plot(.x = struc_data, .f = heatmap_plot_func))
data %>%
trelliscope(name = title)
data %>%
trelliscope(name = title,path = getwd())
data %>%
trelliscope(name=title,
path = "~heatmap",
thumb = T,
nrow = 1,
ncol = 2
)
library(PWtrelliscopeFunctions)
gapminder::gapminder
sankey_trelliscope(gapminder::gapminder[c("continent",'country','pop', 'year')], facet = "year", quant_variable = 'pop', title = "")
PWtrelliscopeFunctions::sankey_trelliscope(gapminder::gapminder[c("continent",'country','pop', 'year')], facet = "year", quant_variable = 'pop', title = "")
library(trelliscopejs)
library(tidyverse)
library(plotly)
PWtrelliscopeFunctions::sankey_trelliscope(gapminder::gapminder[c("continent",'country','pop', 'year')], facet = "year", quant_variable = 'pop', title = "")
heatmap_struc_func
#helper Function 1
heatmap_struc_func <- function(dat1){
x <- colnames(dat1)[1]
y <- colnames(dat1)[2]
fill <- colnames(dat1)[3]
dat1 <- dat1 %>%
group_by(.dots = c(x,y)) %>%
summarise(!!fill := sum(!!sym(fill))) %>%
right_join(place_holder_dat, by = c(x,y)) %>%
ungroup()
dat1[is.na(dat1[,3]),3] <- 0
dat1
}
heatmap_plot_func <- function(dat){
cols <- colnames(dat)
x_var <- cols[2]
y_var <- cols[1]
fill_var <- cols[3]
plot_ly(
data = dat,
x = as.formula(paste0('~', x_var)),
y = as.formula(paste0('~', y_var)),
z = as.formula(paste0('~', fill_var)),
type = "heatmap",
hoverinfo = 'text',
text = ~paste('</br> ',y_var,': ', dat[,2],
'</br> ',x_var,': ', dat[,1],
'</br> ',fill_var,': ', dat[,3])) %>%
layout(
xaxis = list(showticklabels=FALSE,
ticks = ""),
yaxis = list(showticklabels=FALSE,
ticks = "")
)
}
#### Testing this crap out
data = gapminder::gapminder
facet = "continent"
x = "year"
y = "country"
fill = "lifeExp"
title = ""
varx <- unique(data[,x])[[1]]
vary <- unique(data[,y])[[1]]
place_holder_dat <<- expand.grid(varx,vary)
colnames(place_holder_dat) <- c(x,y)
data <- suppressWarnings(nest(data, -facet))
data <- suppressMessages(
data %>%
mutate(struc_data = map(data, heatmap_struc_func))
)
rm(place_holder_dat, pos = ".GlobalEnv")
data <- data %>%
mutate(heat_plot = map_plot(.x = struc_data, .f = heatmap_plot_func))
data %>%
trelliscope(name=title,
path = "C:/Users/tymax/Desktop",
thumb = T,
nrow = 1,
ncol = 2
)
data %>%
trelliscope(name=title,
thumb = T,
nrow = 1,
ncol = 2
)
